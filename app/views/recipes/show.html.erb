<% @user ||= current_user  %>

<script>
  analytics.track('Viewed Recipe', {
  recipe_id: <%= @recipe.id %>,
  recipe_name: <%= @recipe.name %>
  author: <%= @recipe.user_id %>
}); 
</script>


<h5>Fans (<%= @recipe.fans.count %>)</h5>
      <% unless @recipe.fans.empty? %>
      <% @recipe.fans.each do |fan| %>
        <div>
          <span><%= link_to fan.first_name, fan %></span>
        </div>
      <% end %>
      <% end %>

<% unless @user.nil? %>
    <% if @user.saved_to_favorites?(@recipe) %>
      <div>
        <%= button_to "Remove from Fav", recipe_favorite_path(@recipe, @current_favorite), method: :delete, class: 'btn btn-default' %>
      </div>
    <% else %>
      <div>
        <%= button_to "Add to Fav", recipe_favorites_path(@recipe), class: 'btn btn-primary' %>
      </div>
    <% end %>
<% end  %>

<p>
  <%= image_for(@recipe) %>
</p>
<p>
  <strong>Name:</strong>
  <%= @recipe.name %>
</p>

<p>
  <strong>Description:</strong>
  <%= @recipe.description %>
</p>

<p>
  <strong>Tags:</strong>
  <%= tags_for(@recipe) %>
</p>

<p>
  <strong>Method:</strong>
  <%= @recipe.method %>
</p>

<p>
  <strong>Serving:</strong>
  <%= @recipe.serving %>
</p>

<p>
  <strong>Source:</strong>
  <%= @recipe.source %>
</p>


<p>
  <strong>Ingredients:</strong>
    <% if @recipe.ingredients.any?  %>
      <ul>
        <% @recipe.ingredients.each do |ingredient|  %>
          <li> <%= link_to ingredient.food_item.name, ingredient_path(ingredient.food_item.name) %>: 
            <%= ingredient.volume %>
          </li>
        <% end  %>
      </ul>  
    <% end  %>
</p>

<% if @user.try(:admin?) %>
    <div class="admin_console">
      <%= link_to 'Edit', edit_recipe_path(@recipe) %> |
      <%= link_to 'Destroy', @recipe, method: :delete, data: { confirm: 'Are you sure?' } %>
    </div>
  <% end %>

<hr>


<div class="row">
  <div id="comments_count">
    <h4><%= pluralize(@recipe.comments.count, 'comment') %></h4>
  </div>
</div>

  <% unless @recipe.comments.blank? %>
  <div class="row">
    <div id="comments_list">
      <% @recipe.comments.each do |comment| %>
        <% unless comment.user.blank? %>
      <div class="media" id="comment-id-<%= comment.id %>">
        <a class="pull-left" href="#">
          <%= image_tag(gravatar_url(comment.user), width: 38, class: "img-circle") %>
        </a>
        <div class="media-body">
          <div class="media-heading">
            <strong><%= link_to comment.user.first_name, comment.user %></strong>
          </div> 
          <p>
            <%= comment.content %>
            <span class="muted"><%= time_ago_in_words(comment.created_at) %> ago</span>
            
            <% if @user == comment.user %>
            <span style="font-size:12px;">
              <%= link_to 'Delete', recipe_comment_path(@recipe, comment), method: :delete, remote: true %>  
            </span>
            <% end %>
          </p>
        </div>
      </div>
      <% end %>
      <% end %>
    </div>
  </div>
  <% end %>

 <%= render 'comments/form' %>
